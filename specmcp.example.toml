# SpecMCP Configuration
#
# This file is optional. All values have sensible defaults.
# Environment variables always override values set here.
#
# Config file search order (first found wins):
#   1. --config flag
#   2. SPECMCP_CONFIG env var
#   3. ./specmcp.toml (current directory)
#   4. ~/.config/specmcp/specmcp.toml

# ── Emergent Connection ──────────────────────────────────────────────

[emergent]
# Emergent server URL.
# Env: EMERGENT_URL
# url = "http://localhost:3002"

# Project-scoped token (emt_*). Required for stdio mode.
# In HTTP mode, each client sends their own token as the Bearer header
# and this field is not needed.
# Env: EMERGENT_TOKEN or EMERGENT_API_KEY
# token = ""

# Explicit project ID. Only needed with standalone API keys (not emt_* tokens).
# Env: EMERGENT_PROJECT_ID
# project_id = ""

# Maximum number of retry attempts for failed Emergent API requests.
# Set to -1 for infinite retries (keeps trying to reconnect forever).
# Env: EMERGENT_MAX_RETRIES
# max_retries = 5

# After many consecutive failures, wait this many minutes between retries.
# This prevents aggressive reconnection during long outages (e.g., Emergent down for 1+ hour).
# Env: EMERGENT_LONG_OUTAGE_INTERVAL_MINS
# long_outage_interval_mins = 5

# Number of consecutive failures before switching to long outage mode.
# After this many failures, retries slow down to long_outage_interval_mins.
# Env: EMERGENT_LONG_OUTAGE_THRESHOLD
# long_outage_threshold = 20

# Admin token for server-side operations (janitor, health checks) in HTTP mode.
# Env: EMERGENT_ADMIN_TOKEN
# admin_token = ""

# ── Transport ────────────────────────────────────────────────────────

[transport]
# Transport mode: "stdio" or "http".
# Env: SPECMCP_TRANSPORT
# mode = "stdio"

# HTTP listen port. Only used when mode = "http".
# Env: SPECMCP_PORT
# port = "21452"

# HTTP listen address. Only used when mode = "http".
# Env: SPECMCP_HOST
# host = "0.0.0.0"

# Comma-separated list of allowed CORS origins. Only used when mode = "http".
# Env: SPECMCP_CORS_ORIGINS
# cors_origins = "*"

# Request timeout in minutes. How long to wait for HTTP requests/responses.
# Increase this for long-running operations like syncs or large graph queries.
# Env: SPECMCP_REQUEST_TIMEOUT_MINUTES
# request_timeout_minutes = 5

# Idle timeout in minutes. How long to keep idle connections alive.
# Increase this to avoid reconnection overhead for active sessions.
# Env: SPECMCP_IDLE_TIMEOUT_MINUTES
# idle_timeout_minutes = 5

# ── Logging ──────────────────────────────────────────────────────────

[log]
# Log level: debug, info, warn, error.
# Env: SPECMCP_LOG_LEVEL
# level = "info"

# ── Janitor ──────────────────────────────────────────────────────────

[janitor]
# Enable scheduled janitor runs (stdio mode only).
# The janitor verifies artifact compliance and project health.
# Env: SPECMCP_JANITOR_ENABLED
# enabled = false

# How often to run the janitor (in hours).
# Env: SPECMCP_JANITOR_INTERVAL_HOURS
# interval_hours = 1

# Automatically create maintenance proposals for critical issues.
# When false, the janitor only logs issues.
# Env: SPECMCP_JANITOR_CREATE_PROPOSAL
# create_proposal = false

# Automatically create Improvement entities from janitor findings.
# Improvements are grouped by issue type (naming, orphaned, missing relationships, etc.)
# with individual Tasks for each specific issue.
# Env: SPECMCP_JANITOR_CREATE_IMPROVEMENTS
# create_improvements = false

# Severity levels that trigger improvement creation (comma-separated).
# Only issues at these levels will generate Improvements.
# Env: SPECMCP_JANITOR_IMPROVEMENT_THRESHOLDS
# improvement_thresholds = ["critical", "warning"]
